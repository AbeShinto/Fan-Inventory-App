<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Inventory App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Raleway:wght@700&family=Merriweather:wght@400;700&display=swap');
        body { font-family: 'Merriweather', serif; }
        .header-font { font-family: 'Raleway', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    <!-- The script below contains the React application code. -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Custom, self-contained SVG icon components
        const Fan = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M10 8.873a4 4 0 1 0 5.245 5.245" />
                <path d="M12 12L2 2" />
                <path d="M12 12L2 22" />
                <path d="M12 12l10 10" />
                <path d="M12 12l-1.321 8.679" />
                <path d="M12 12l8.679-1.321" />
            </svg>
        );

        const Cloud = ({ className }) => (
             <svg xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 60 60" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
<rect id="bg" x="-144" y="-149" display="none" fill="#6DCFF6" width="544" height="455"/>
<g id="Fan">
	<path d="
		c0-1.7-1.4-3-3-3h-8v-2.3C49.6,53.8,60,42.1,60,28z M6,28C6,13.7,17.7,2,32,2s26,11.7,26,26S46.3,54,32,54S6,42.3,6,28z M44,60
		c0.6,0,1,0.5,1,1c0,0.5-0.4,1-1,1H20c-0.4,0-1-0.6-1-1s0.6-1,1-1h8h8H44z M34,58h-4v-2.1c0.7,0,1.3,0.1,2,0.1s1.3,0,2-0.1V58z"/>
	<path d="M39.2,35.1c-0.7-1.6-2.1-3.2-3.1-4.3c0.4-0.6,0.7-1.4,0.8-2.2c0.9,0,2,0.3,4.5,2.3c0.1,0.1,0.3,0.2,0.5,0.4
		c1.3,1,3.3,2.7,5.7,2.7c0.9,0,1.9-0.3,2.9-0.9c1.7-1.2,2.7-3.3,2.7-6.2c0-3.8-2-9-5.7-11.4c-5.6-3.6-10.9-1.3-13.5,2.7
		c-0.9,1.3-1.7,3.3-2.2,4.9c-0.7,0-1.3,0.2-1.9,0.4c-0.5-0.8-0.9-1.9-0.6-5.1c0-0.2,0-0.4,0.1-0.6c0.2-2.3,0.7-6.5-3.2-8.2
		c-1.9-0.8-4.3-0.4-6.6,1.1c-3.2,2.1-6.4,6.6-6.4,11c0,6.7,4.9,9.8,9.6,9.9c0.1,0,0.1,0,0.2,0c1.7,0,3.6-0.5,4.9-0.8
		c0.3,0.5,0.7,0.8,1.1,1.2c-0.5,0.8-1.5,1.9-4.5,3.1c-0.2,0.1-0.4,0.1-0.6,0.2c-2.1,0.8-6.1,2.3-5.9,6.5c0.1,2.1,1.5,4,3.9,5.4
		c2,1.2,4.9,2,7.7,2c1.7,0,3.5-0.3,5-1.1C40.6,45.1,41.2,39.4,39.2,35.1z M29,28c0-1.7,1.3-3,3-3s3,1.3,3,3s-1.3,3-3,3
		S29,29.7,29,28z M35.6,19.2c2-2.9,6-5.2,10.8-2.1c2.7,1.7,4.7,5.9,4.8,9.7c0,1.2-0.2,3.5-1.8,4.5c-2.1,1.4-4.1,0-6.2-1.7
		c-0.2-0.1-0.4-0.3-0.5-0.4c-3-2.3-4.5-2.6-5.9-2.7c-0.4-1.5-1.5-2.7-3-3.2C34.2,22,34.9,20.3,35.6,19.2z M22.8,29.6
		c-3.5-0.1-7.6-2.2-7.7-7.9c0-3.2,2.4-7.2,5.5-9.3c1-0.7,3-1.7,4.7-1c2.3,1,2.3,3.5,2,6.1c0,0.2,0,0.5-0.1,0.7c-0.3,4,0.4,5.4,1,6.4
		C27.5,25.5,27,26.7,27,28c0,0.3,0,0.6,0.1,0.9C25.9,29.2,24.2,29.6,22.8,29.6z M22.9,45.4c-1.1-0.6-2.9-1.9-2.9-3.8
		c-0.1-2.5,2.1-3.6,4.6-4.5c0.2-0.1,0.4-0.2,0.6-0.2c3.8-1.5,4.9-3,5.5-4c0.4,0.1,0.8,0.2,1.3,0.2c1,0,1.9-0.3,2.7-0.8
		c0.8,0.9,2.1,2.4,2.7,3.7c1.5,3.2,1.4,7.8-3.7,10.4C30.8,47.7,26.2,47.3,22.9,45.4z"/>
</g>
</svg>
            </svg>
        );

        const Loader2 = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 12a9 9 0 1 1-6.219-8.56" />
            </svg>
        );

        // This is a minimal set of components to be self-contained in a single file.
        const Card = ({ className, ...props }) => (
          <div className={`rounded-xl border bg-white text-card-foreground shadow ${className}`} {...props} />
        );
        const CardHeader = ({ className, ...props }) => (
          <div className={`flex flex-col space-y-1.5 p-6 ${className}`} {...props} />
        );
        const CardTitle = ({ className, ...props }) => (
          <h3 className={`text-2xl font-semibold leading-none tracking-tight ${className}`} {...props} />
        );
        const CardDescription = ({ className, ...props }) => (
          <p className={`text-sm text-muted-foreground ${className}`} {...props} />
        );
        const CardContent = ({ className, ...props }) => (
          <div className={`p-6 pt-0 ${className}`} {...props} />
        );

        // This is the core application logic.
        const App = () => {
          // State to hold the full inventory data, the selected item, and loading status.
          const [inventory, setInventory] = useState(null);
          const [selectedItem, setSelectedItem] = useState(null);
          const [isLoading, setIsLoading] = useState(true);
          const [error, setError] = useState(null);

          // This useEffect hook runs once when the component mounts.
          // It's responsible for fetching the data from the Google Sheet and
          // parsing the URL for a specific asset ID.
          useEffect(() => {
            const googleSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTKobFwtYisWy2rthSlulMKz58izHff6DV_G2v6YeNHAVur-wugvpZXOWy-BTSgZ1r8DbY7tDNFOYk-/pub?gid=0&single=true&output=csv';

            const fetchData = async () => {
              try {
                const response = await fetch(googleSheetUrl);
                if (!response.ok) {
                  throw new Error(`Failed to fetch inventory data. Server responded with status: ${response.status}. This can happen if the Google Sheet URL is incorrect or not properly published to the web as a CSV.`);
                }

                const text = await response.text();

                // Log the raw text to the console for debugging
                console.log('--- Raw data from Google Sheet ---');
                console.log(text);
                console.log('--- End of raw data ---');

                // Check if the response is empty or invalid
                if (!text || text.trim() === '') {
                  throw new Error('Received an empty response from the Google Sheet URL. Please ensure it is published correctly and contains data.');
                }
                
                // Split the text into lines and filter out any completely empty ones.
                const lines = text.split('\n').filter(line => line.trim() !== '');

                // Log the lines array to the console for debugging
                console.log('--- Parsed lines ---');
                console.log(lines);
                console.log('--- End of parsed lines ---');

                const headers = lines[0].split(',').map(header => header.trim().toLowerCase());
                
                if (headers.length < 1 || !headers[0].startsWith('id')) {
                    throw new Error('The data does not appear to be a valid CSV. Please ensure the first column is "id" and the sheet is published correctly.');
                }

                const parsedData = lines.slice(1).map(line => {
                  const values = line.split(',');
                  let item = {};
                  headers.forEach((header, index) => {
                    // Gracefully handle missing data to prevent errors
                    item[header] = values[index] ? values[index].trim() : '';
                  });
                  return item;
                });

                setInventory(parsedData);

                // Check for an 'id' query parameter in the URL.
                const urlParams = new URLSearchParams(window.location.search);
                const id = urlParams.get('id');

                if (id && parsedData) {
                  const foundItem = parsedData.find(item => item.id === id);
                  if (foundItem) {
                    setSelectedItem(foundItem);
                  } else {
                    setError(`Asset with ID "${id}" not found.`);
                  }
                }
              } catch (e) {
                console.error(e);
                setError(e.message);
              } finally {
                setIsLoading(false);
              }
            };

            fetchData();
          }, []); // Empty dependency array ensures this runs only once.

          // Conditional rendering for the different views of the app.
          // The primary view is the single item detail page.
          const renderContent = () => {
            if (isLoading) {
              return (
                <div className="flex flex-col items-center justify-center h-screen">
                  <Loader2 className="h-10 w-10 animate-spin text-gray-500" />
                  <p className="mt-4 text-lg text-gray-700">Loading inventory data...</p>
                </div>
              );
            }

            if (error) {
              return (
                <div className="flex flex-col items-center justify-center h-screen p-4 text-center">
                  <h1 className="text-4xl font-bold text-red-600">Error</h1>
                  <p className="mt-4 text-xl text-red-500">{error}</p>
                </div>
              );
            }

            if (selectedItem) {
              return (
                <div className="p-4 md:p-8 lg:p-12">
                  {/* The card content container retains its original size (max-w-2xl mx-auto) */}
                  <Card className="max-w-2xl mx-auto border-4 border-gray-100 dark:border-gray-800">
                    <CardHeader className="bg-gray-100 dark:bg-gray-800 rounded-t-xl flex flex-row items-center justify-between">
                      <div className="flex items-center space-x-4">
                        {selectedItem.type && selectedItem.type.toLowerCase() === 'fan' ? (
                          <Fan className="h-10 w-10 text-blue-500" />
                        ) : (
                          <Cloud className="h-10 w-10 text-gray-500" />
                        )}
                        <div>
                          <CardTitle className="text-gray-900 dark:text-gray-100">{selectedItem.name}</CardTitle>
                          <CardDescription className="text-gray-600 dark:text-gray-400 font-medium">Asset ID: {selectedItem.id}</CardDescription>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent className="mt-6 space-y-4 text-gray-700 dark:text-gray-300">
                      <p>
                        <span className="font-semibold text-gray-900 dark:text-gray-100">Type:</span> {selectedItem.type}
                      </p>
                      <p>
                        <span className="font-semibold text-gray-900 dark:text-gray-100">Location:</span> {selectedItem.location}
                      </p>
                      <p>
                        <span className="font-semibold text-gray-900 dark:text-gray-100">Status:</span> {selectedItem.status}
                      </p>
                      <p>
                        <span className="font-semibold text-gray-900 dark:text-gray-100">Last Serviced:</span> {selectedItem.last_serviced}
                      </p>
                      <p>
                        <span className="font-semibold text-gray-900 dark:text-gray-100">Notes:</span> {selectedItem.notes}
                      </p>
                    </CardContent>
                  </Card>
                </div>
              );
            }

            // This is the default view if no ID is provided.
            return (
              <div className="flex flex-col items-center justify-center p-4 text-center">
                <p className="mt-4 text-xl text-white max-w-xl">
                  This app is designed to display details for a specific asset.
                  Please scan an NFC tag or manually add `?id=[asset_id]` to the URL to view an item.
                </p>
                <p className="mt-2 text-lg text-white">
                  Example: `your-app-url?id=FAN001`
                </p>
              </div>
            );
          };

          return (
            <div className="min-h-screen text-gray-900 dark:text-gray-100 flex flex-col items-center" style={{ backgroundColor: '#4094b0' }}>
                <h1 className="text-5xl font-extrabold text-white mt-8 mb-8 header-font p-4 w-full text-center" style={{ backgroundColor: '#005776' }}>CCA Facilities Inventory</h1> {/* Global Header */}
                <div className="flex-grow flex flex-col items-center justify-center w-full">
                    {renderContent()}
                </div>
                {/* START FOOTER SECTION */}
                <div className="text-lg text-gray-800 header-font p-4 w-full text-center mt-auto" style={{ backgroundColor: '#ef9149' }}>
                    Link or Item number not working? email us at <span className="font-bold">OUR EMAIL</span>
                </div>
                {/* END FOOTER SECTION */}
            </div>
          );
        };

        // This is the standard entry point for a React app.
        // It initializes the React DOM and renders the App component.
        window.onload = function() {
            try {
                const container = document.getElementById('root');
                if (container) {
                    const root = ReactDOM.createRoot(container);
                    root.render(
                        <React.StrictMode>
                            <App />
                        </React.StrictMode>
                    );
                } else {
                    console.error('Root element not found. React app cannot mount.');
                }
            } catch (e) {
                console.error('Error rendering React app:', e);
                // You could display a user-friendly error message here if needed
            }
        };
    </script>
</body>
</html>
